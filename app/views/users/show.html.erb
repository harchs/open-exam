<h2><%= @user.name %></h2>
<% unless current_user.is_admin? %>
  <h1>Quizzes you have taken:</h1>

  <%if @quizzes.count > 0 %>

      <% @quizzes.each do |quiz|  %>
        <% if current_user.has_taken?(quiz) %>
        <% @num_correct = QuizGrader.num_correct(current_user.answers_for_quiz(quiz.id), quiz)%>
        <div class="quiz_listing">
          <% if @num_correct.to_f/quiz.approved_questions.count >= quiz.passing_grade.to_f/100 %>
            <% image_source = "/assets/smile_1.png" %>
          <% else %>
            <% image_source = "/assets/smile_5.png" %>
          <% end %>
          
          <h3><%= quiz.name %> <img src=<%= image_source %> ></h3>

          <div class="quiz_info">
            <p class="quiz_description"><%= quiz.description %></p>
            Taken <%= time_ago_in_words(quiz.answers.find_by_quiz_id(quiz).created_at) %> ago.
            <%= link_to "View result", score_path(:id => quiz.id, :user_id => @user.id) %>
          </div>

        </div>

        <% end %>
      <% end %>

  <% else %>

    You have not taken any quizzes. Visit the <%= link_to "Take Quiz page", quizzes_path %> to take one.

  <% end %>

<% else %>
  <% user = User.find_by_id(params[:id]) || current_user%>
  <h1>Quizzes <%= user.name %> has taken:</h1>


  <%if user.quizzes_taken.count > 0 %>

      <% @quizzes.each do |quiz|  %>
        <% if user.has_taken?(quiz) %>
        <% @num_correct = QuizGrader.num_correct(user.answers_for_quiz(quiz.id), quiz)%>
        <div class="quiz_listing">
          <% if @num_correct.to_f/quiz.approved_questions.count >= quiz.passing_grade.to_f/100 %>
            <% image_source = "/assets/smile_1.png" %>
          <% else %>
            <% image_source = "/assets/smile_5.png" %>
          <% end %>
          
          <h3><%= quiz.name %> <img src=<%= image_source %> ></h3>

          <div class="quiz_info">
            <p class="quiz_description"><%= quiz.description %></p>
            Taken <%= time_ago_in_words(quiz.answers.find_by_quiz_id(quiz).created_at) %> ago.
            <%= link_to "View result", score_path(quiz.id, user.id) %>
          </div>

        </div>

        <% end %>
      <% end %>

  <% else %>

    <%= user.name %> has not taken any quizzes yet.

  <% end %>

<% end %>